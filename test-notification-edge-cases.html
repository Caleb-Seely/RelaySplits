<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Edge Cases Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .button { padding: 10px 15px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; border-radius: 3px; margin: 10px 0; font-family: monospace; font-size: 12px; }
        .test-case { margin: 10px 0; padding: 10px; background: #f0f0f0; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>Notification Edge Cases Test</h1>
    
    <div class="test-section">
        <h3>Test Cases</h3>
        
        <div class="test-case">
            <h4>Test 1: First Leg Start</h4>
            <p>When leg 1 starts, should show: "And they're off! üèÉ‚Äç‚ôÇÔ∏è"</p>
            <button class="button" onclick="testFirstLegStart()">Test First Leg Start</button>
        </div>
        
        <div class="test-case">
            <h4>Test 2: Regular Handoff (Leg 5 ‚Üí Leg 6)</h4>
            <p>When leg 5 finishes and hands off to leg 6, should show: "Handoff Complete! ü§ù"</p>
            <button class="button" onclick="testRegularHandoff()">Test Regular Handoff</button>
        </div>
        
        <div class="test-case">
            <h4>Test 3: Last Leg Handoff (Leg 35 ‚Üí Leg 36)</h4>
            <p>When leg 35 finishes and hands off to leg 36, should show: "Last leg! üèÉ‚Äç‚ôÇÔ∏è"</p>
            <button class="button" onclick="testLastLegHandoff()">Test Last Leg Handoff</button>
        </div>
        
        <div class="test-case">
            <h4>Test 4: Race Complete (Leg 36 finishes)</h4>
            <p>When leg 36 finishes, should show: "Race Complete! üéâ"</p>
            <button class="button" onclick="testRaceComplete()">Test Race Complete</button>
        </div>
        
        <div id="test-results" class="log"></div>
    </div>

    <script>
        function log(message) {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('test-results').innerHTML = '';
        }

        async function testFirstLegStart() {
            clearLog();
            log('Testing First Leg Start notification...');
            
            if (!('Notification' in window) || Notification.permission !== 'granted') {
                log('Notifications not available or permission not granted');
                return;
            }
            
            try {
                const notification = new Notification("And they're off! üèÉ‚Äç‚ôÇÔ∏è", {
                    body: "John Doe is leaving Timberline!",
                    icon: '/icon-192.png',
                    badge: '/icon-96.png',
                    requireInteraction: false,
                    tag: 'test-first-leg-start'
                });
                log('‚úì First leg start notification sent');
                
                setTimeout(() => notification.close(), 3000);
            } catch (error) {
                log('‚úó Error sending first leg start notification: ' + error.message);
            }
        }

        async function testRegularHandoff() {
            clearLog();
            log('Testing Regular Handoff notification...');
            
            if (!('Notification' in window) || Notification.permission !== 'granted') {
                log('Notifications not available or permission not granted');
                return;
            }
            
            try {
                const notification = new Notification("Handoff Complete! ü§ù", {
                    body: "Jane Smith hands off to Bob Johnson running Leg 6!",
                    icon: '/icon-192.png',
                    badge: '/icon-96.png',
                    requireInteraction: false,
                    tag: 'test-regular-handoff'
                });
                log('‚úì Regular handoff notification sent');
                
                setTimeout(() => notification.close(), 3000);
            } catch (error) {
                log('‚úó Error sending regular handoff notification: ' + error.message);
            }
        }

        async function testLastLegHandoff() {
            clearLog();
            log('Testing Last Leg Handoff notification...');
            
            if (!('Notification' in window) || Notification.permission !== 'granted') {
                log('Notifications not available or permission not granted');
                return;
            }
            
            try {
                const notification = new Notification("Last leg! üèÉ‚Äç‚ôÇÔ∏è", {
                    body: "Alice Brown hands off to Charlie Davis and they are headed to the sand!",
                    icon: '/icon-192.png',
                    badge: '/icon-96.png',
                    requireInteraction: false,
                    tag: 'test-last-leg-handoff'
                });
                log('‚úì Last leg handoff notification sent');
                
                setTimeout(() => notification.close(), 3000);
            } catch (error) {
                log('‚úó Error sending last leg handoff notification: ' + error.message);
            }
        }

        async function testRaceComplete() {
            clearLog();
            log('Testing Race Complete notification...');
            
            if (!('Notification' in window) || Notification.permission !== 'granted') {
                log('Notifications not available or permission not granted');
                return;
            }
            
            try {
                const notification = new Notification("Race Complete! üéâ", {
                    body: "Charlie Davis finished Leg 36. Amazing job, team!",
                    icon: '/icon-192.png',
                    badge: '/icon-96.png',
                    requireInteraction: false,
                    tag: 'test-race-complete'
                });
                log('‚úì Race complete notification sent');
                
                setTimeout(() => notification.close(), 3000);
            } catch (error) {
                log('‚úó Error sending race complete notification: ' + error.message);
            }
        }

        // Auto-request notification permission on page load
        window.addEventListener('load', async () => {
            if ('Notification' in window && Notification.permission === 'default') {
                const permission = await Notification.requestPermission();
                log(`Notification permission: ${permission}`);
            }
        });
    </script>
</body>
</html>
